<!DOCTYPE html>
<html>

<head>
    <title>Title</title>
    <meta charset="utf-8">
    <style>
        @import url(https://fonts.googleapis.com/css?family=Yanone+Kaffeesatz);
        @import url(https://fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic);
        @import url(https://fonts.googleapis.com/css?family=Ubuntu+Mono:400,700,400italic);

        body {
            font-family: 'Droid Serif';
        }

        blockquote::before {
            content: open-quote;
            margin-right: 5px;
            font-size: 1.2em;
        }

        blockquote {
            border-left: 0.3em solid #ccc;
            padding: 0 15px;
            font-style: italic;
            color: #ccc;
            quotes: "\201C""\201D""\2018""\2019";
        }

        blockquote::after {
            content: close-quote;
            margin-left: 5px;
            font-size: 1.2em;
        }

        pre {
            margin: 10px 0;
        }

        .remark-code,
        .remark-inline-code {
            font-size: 0.6em;
        }

        h1,
        h2,
        h3 {
            font-family: 'Yanone Kaffeesatz';
            font-weight: normal;
            margin-top: 2px;
            margin-bottom: 2px;
        }

        .external-link {
            color: #ccc !important;
        }

        .overlay {
            font-size: 25px;
            display: flex;
            position: fixed;
            width: 100%;
            top: 40%;
            left: 0;
            background-color: rgba(0, 0, 0, 0.8);
            justify-content: center;
        }

        .bg-green {
            background-color: #008000;
        }

        .bg-red {
            background-color: #ff4242;
        }

        .big-image-wrapper {
            text-align: center;
            margin: 20px 0;
        }

        .big-image {
            width: 80%;
        }

        .huge-font {
            font-size: 1.6em !important;
        }

        .hide {
            display: none !important;
        }

        .transparent {
            visibility: hidden;
        }

        .note {
            font-weight: normal;
            font-size: 0.8em;
        }

        .emphesize {
            color: #fff755;
            text-transform: uppercase;
        }

        .remark-slide-content {
            background-color: #333;
            color: #fff;
        }

        .remark-code,
        .remark-inline-code {
            font-family: 'Ubuntu Mono';
            font-size: 0.6em;
        }

        .remark-code-line-highlighted {
            background-color: rgba(177, 177, 177, 0.3);
        }

        .remark-slide-container {
            transition: all 500ms ease;
        }

        .fade {
            transition: all 500ms ease;
            opacity: 0;
        }

        .remark-visible .fade {
            opacity: 1;
        }

        .home {
            background-image: url("js_logo.jpg");
            background-repeat: no-repeat;
            background-size: contain;
            color: #333;
        }

        .context-box {
            border: 1px solid #777;
            padding: 10px;
        }

        .flex {
            display: flex;
        }

        .spaces-around {
            justify-content: space-around;
        }

        .columns {
            flex-direction: column;
        }

        .rows {
            flex-direction: row;
        }

        .execution-context {
            border: 1px solid #eee;
            font-weight: 100;
            font-size: 0.6em;

        }

        .execution-context.fixed-hight {
            min-height: 235px;
        }

        .promise-context .execution-context {
            min-height: 225px;
        }

        .execution-context-title {
            color: #fff755;
            font-size: 1.1em;
        }

        .nested-context {
            font-size: 0.7em;
            margin: 5px 0;
        }

        .garbage-context {
            opacity: 0.6;
            position: relative;
        }

        .garbage-context::before {
            position: absolute;
            content: "Destroyed *";
            display: flex;
            height: 100%;
            width: 100%;
            align-items: center;
            justify-content: center;
            font-size: 2em;
            background-color: rgba(0, 0, 0, 0.8);
        }

        .call-stack-wrapper {
            flex: 0.7;
        }

        .call-stack {
            justify-content: flex-end;
            padding: 10px;
            border: 1px dashed #fdfe16;
            flex: 1;
        }

        .stack-item {
            font-size: 0.9em;
            border: 1px solid #aaa;
            padding: 3px;
            margin-top: 5px;
        }

        .call-stack .stack-item.active:first-of-type {
            background-color: #008000;
        }

        .stack-item.active-forced {
            background-color: #008000 !important;
        }

        .thread-context {
            flex: 2;
        }

        .var-env {
            flex: 1;
        }

        .var-title {
            margin-right: 10px;
        }

        .var-dclr {
            align-items: center;
        }

        .function {
            border: 1px solid #aaa;
            font-size: 1em;
            padding: 1px 7px 4px 7px;
        }

        .function::before {
            content: "Æ’";
        }

        .var-value.scope::before {
            content: ".[[scope]]= ";
        }

        .closure-wrapper {
            border-left: 3px solid green;
            padding-left: 5px;
        }

        .var-value.closure {
            margin-top: 5px;
            background: #008000;
            padding: 10px 5px;
        }

        .closure-arrow {
            margin-right: 5px;
            font-size: 2em;
        }

        .undefined-var::before {
            content: "______"
        }

        .missing-var {
            font-size: 3em;
            color: #FFEB3B;
        }

        .console {
            margin-top: 8px;
        }

        .browser-api {
            justify-content: space-between;
            align-items: flex-start;
            font-size: 0.8em;
        }

        .ques-wrapper {
            flex: 2;
        }

        .browser-api-title {
            font-size: 1em;
            border-bottom: 1px solid #444;
            margin-bottom: 5px;
        }

        .browser-api-content {
            font-size: 0.7em;
        }

        .que-wrapper {
            display: flex;
            flex-direction: column;
            margin-right: 10px;
        }

        .que-title {
            font-size: 0.7em;
            margin-bottom: 5px;
        }

        .que {
            border: 1px solid #aaa;
            padding: 5px;
            display: flex;
        }


        .task {
            font-size: 0.8em;
            padding: 5px;
            margin-right: 5px;
            background-color: #317aff;
        }


        .task.active {
            background-color: tomato;
        }

        .event-loop-spinner-wrapper {
            flex: 0.1;
        }

        .event-loop-spinner {
            background-image: url(event-loop-colored.gif);
            background-size: contain;
            background-repeat: no-repeat;
            height: 40px;
            width: 40px;
            margin-right: 5px;
            margin-top: 15px;
        }


        .browser-evnviroment {
            flex: 1;
            padding: 0 20px;
        }

        .summary {
            font-size: 0.9em;
        }
    </style>
</head>

<body>
    <textarea id="source">

layout: true
name: questions
class: center middle fade

# Questions?
<img style="max-width: 250px;" src="question.png" />
---

layout: false
class: middle, home, fade

# Async JavaScript
## FROM SCRATCH
#### Part #1
---
class: fade

# Agenda

1. Synchronous Execution
    * Nested Execution Context
    * Call-Stack 
    * Synchronous Limitations

2. Asynchronous Execution
    * Browser API
    * Task Que
    * Event Loop
    * Tasks Vs Micro-tasks

3. Promise

4. Closure

5. Event loop deep dive
    * Render Steps
    * rAF
    * Tasks Priority
---
# Can you guess the order?
```
console.log(1);

setTimeout(() => console.log('timer'), 0);

console.log(2);

Promise.resolve().then(() => console.log('promise'));

console.log(3);
```
--
```
1

2

3

promise

timer
```
--
<div class="flex rows" style="font-size: 8em;">
    <img style="width: auto; max-height: 325px" src="wtf.png" />
    <div>WTF</div>
</div>
---
class: center, middle, fade
layout: true
name: chapter
# Chapter #{{number}}
<hr/>
### {{title}}
#### {{subtitle}}
---
template: chapter
number: 1
title: Synchronous Execution
subtitle: The Execution Context
---

layout: true
name: syncJs

# Execution Context 
{{subTitle}}
---

layout: true
template: syncJs
name: globalExecCodeBlock
```
{{mark1}}const count = 0;
{{mark2}}function add(num1, num2){
    {{mark3}}    return num1 + num2;
}
{{mark4}}const myName = "Sagiv";
```
{{executionContext}}
---
template: globalExecCodeBlock
mark1:
mark2:
mark3:
mark4:
subTitle: What happens when we execute (run) the code:
executionContext:

--
mark1:*
mark2:
mark3:
mark4:
subTitle: Global Execution Context
executionContext: <div class="execution-context flex rows spaces-around">
        <div class="thread-context flex columns context-box">
            <div>
                <div>Thread</div>
                <hr/>
            </div>
            <div class="flex columns">
                <div>const count = 0</div>   
            </div>
        </div>
        <div class="var-env flex columns context-box">
            <div>
                <div>Variable Enviroment</div>
                <hr/>
            </div>
            <div class="flex columns">
                <div class="var-dclr flex rows">
                    <div class="var-title">count:</div>
                    <div class="var-value">0</div>
                </div>
            </div>
        </div>
    </div>

---
mark1:
mark2:*
mark3:
mark4:
subTitle: Global Execution Context
executionContext: <div class="execution-context flex rows spaces-around">
    <div class="thread-context flex columns context-box">
        <div>
            <div>Thread</div>
            <hr/>
        </div>
        <div class="flex columns">
            <div>const count = 0</div>  
            <div>function add(...)</div>  
        </div>
    </div>
    <div class="var-env flex columns context-box">
        <div>
            <div>Variable Enviroment</div>
            <hr/>
        </div>
        <div class="flex columns">
            <div class="var-dclr flex rows">
                <div class="var-title">count:</div>
                <div class="var-value">0</div>
            </div>
            <div class="var-dclr flex rows">
                    <div class="var-title">add:</div>
                    <div class="var-value function"></div>
                </div>
        </div>
    </div>
</div>

---
mark1:
mark2:
mark3:
mark4:*
subTitle: Global Execution Context
executionContext: <div class="execution-context flex rows spaces-around">
    <div class="thread-context flex columns context-box">
        <div>
            <div>Thread</div>
            <hr/>
        </div>
        <div class="flex columns">
            <div>const count = 0</div>
            <div>function add(...)</div>
            <div>myName = "Sagiv"</div> 
        </div>
    </div>
    <div class="var-env flex columns context-box">
        <div>
            <div>Variable Enviroment</div>
            <hr/>
        </div>
        <div class="flex columns">
            <div class="var-dclr flex rows">
                <div class="var-title">count:</div>
                <div class="var-value">0</div>
            </div>
            <div class="var-dclr flex rows">
                    <div class="var-title">add:</div>
                    <div class="var-value function"></div>
            </div>
            <div class="var-dclr flex rows">
                    <div class="var-title">myName:</div>
                    <div class="var-value">"Sagiv"</div>
            </div>
        </div>
    </div>
</div>

---

layout: true
template: syncJs
name: localExec
subTitle: Local Execution Context
---
layout: true
template: localExec
name: localExecCodeBlock
```
const num = 0;
function add2(input){
    const result = input + 2;
    return result;
}
const result1 = add2(2);
const result2 = add2(8);
```
---
template: localExecCodeBlock

When we execute a function we create a new execution context.
1. A thread of execution (same thread we just jump inside)
2. A local memory (variable enviroment) for the function (hidden from the outer memory "scope")

---
template: localExec
```
*const num = 0;
function add2(input){
    const result = input + 2;
    return result;
}
const result1 = add2(2);
const result2 = add2(8);
```
<div class="execution-context flex rows spaces-around">
        <div class="thread-context flex columns context-box">
            <div>
                <div>Thread</div>
                <hr/>
            </div>
            <div class="flex columns">
                <div>const num = 0</div>
            </div>
        </div>
        <div class="var-env flex columns context-box">
            <div>
                <div>Variable Enviroment</div>
                <hr/>
            </div>
            <div class="flex columns">
                <div class="var-dclr flex rows">
                    <div class="var-title">num:</div>
                    <div class="var-value">0</div>
                </div>
            </div>
        </div>
    </div>

---
template: localExec
```
const num = 0;
*function add2(input){
    const result = input + 2;
    return result;
}
const result1 = add2(2);
const result2 = add2(8);
```
<div class="execution-context flex rows spaces-around">
        <div class="thread-context flex columns context-box">
            <div>
                <div>Thread</div>
                <hr/>
            </div>
            <div class="flex columns">
                <div>const num = 0</div>
                <div>function add2(...)</div>
            </div>
        </div>
        <div class="var-env flex columns context-box">
            <div>
                <div>Variable Enviroment</div>
                <hr/>
            </div>
            <div class="flex columns">
                <div class="var-dclr flex rows">
                    <div class="var-title">num:</div>
                    <div class="var-value">0</div>
                </div>
                <div class="var-dclr flex rows">
                        <div class="var-title">add2:</div>
                        <div class="var-value function"></div>
                    </div>
            </div>
        </div>
    </div>

---
template: localExec
```
const num = 0;
function add2(input){
    const result = input + 2;
    return result;
}
*const result1 = add2(2);
const result2 = add2(8);
```
<div class="execution-context flex rows spaces-around">
        <div class="thread-context flex columns context-box">
            <div>
                <div>Thread</div>
                <hr/>
            </div>
            <div class="flex columns">
                <div>const num = 0</div>
                <div>function add2(...)</div>
                <div>const result1 = add2(2)</div>
            </div>
        </div>
        <div class="var-env flex columns context-box">
            <div>
                <div>Variable Enviroment</div>
                <hr/>
            </div>
            <div class="flex columns">
                <div class="var-dclr flex rows">
                    <div class="var-title">num:</div>
                    <div class="var-value">0</div>
                </div>
                <div class="var-dclr flex rows">
                        <div class="var-title">add2:</div>
                        <div class="var-value function"></div>
                </div>
                <div class="var-dclr flex rows">
                        <div class="var-title">result1:</div>
                        <div class="var-value">_____</div>
                </div>
            </div>
        </div>
    </div>

---
template: localExec
```
const num = 0;
*function add2(input){ // input = 2
    const result = input + 2;
    return result;
}
const result1 = add2(2);
const result2 = add2(8);
```
<div class="execution-context flex rows spaces-around">
        <div class="thread-context flex columns context-box">
            <div>
                <div>Thread</div>
                <hr/>
            </div>
            <div class="flex columns">
                <div>const num = 0</div>
                <div>function add2(...)</div>
                <div>const result1 = add2(2)</div>
                <div class="execution-context nested-context flex rows spaces-around">
                        <div class="thread-context flex columns context-box">
                                <div>
                                    <div>Thread</div>
                                    <hr/>
                                    <div class="flex columns">
                                        <div>input = 2</div>
                                    </div>
                                </div>
                        </div>
                        <div class="var-env flex columns context-box">
                                <div>
                                    <div>Memory</div>
                                    <hr/>
                                </div>
                                <div class="flex columns">
                                        <div class="var-dclr flex rows">
                                                <div class="var-title">input:</div>
                                                <div class="var-value">2</div>
                                        </div>
                                </div>
                        </div>
                </div>
            </div>
        </div>
        <div class="var-env flex columns context-box">
            <div>
                <div>Variable Enviroment</div>
                <hr/>
            </div>
            <div class="flex columns">
                <div class="var-dclr flex rows">
                    <div class="var-title">num:</div>
                    <div class="var-value">0</div>
                </div>
                <div class="var-dclr flex rows">
                        <div class="var-title">add2:</div>
                        <div class="var-value function"></div>
                </div>
                <div class="var-dclr flex rows">
                        <div class="var-title">result1:</div>
                        <div class="var-value">_____</div>
                </div>
            </div>
        </div>
    </div>

---
template: localExec

```
const num = 0;
function add2(input){ // input = 2
*   const result = input + 2;
    return result;
}
const result1 = add2(2);
const result2 = add2(8);
```
<div class="execution-context flex rows spaces-around">
        <div class="thread-context flex columns context-box">
            <div>
                <div>Thread</div>
                <hr/>
            </div>
            <div class="flex columns">
                <div>const num = 0</div>
                <div>function add2(...)</div>
                <div>const result1 = add2(2)</div>
                <div class="execution-context nested-context flex rows spaces-around">
                        <div class="thread-context flex columns context-box">
                                <div>
                                    <div>Thread</div>
                                    <hr/>
                                    <div class="flex columns">
                                        <div>input = 2</div>
                                        <div>const result = 2 + 2</div>
                                    </div>
                                </div>
                        </div>
                        <div class="var-env flex columns context-box">
                                <div>
                                    <div>Memory</div>
                                    <hr/>
                                </div>
                                <div class="flex columns">
                                        <div class="var-dclr flex rows">
                                            <div class="var-title">input:</div>
                                            <div class="var-value">2</div>
                                        </div>
                                        <div class="var-dclr flex rows">
                                                <div class="var-title">result:</div>
                                                <div class="var-value">4</div>
                                        </div>
                                </div>
                        </div>
                </div>
            </div>
        </div>
        <div class="var-env flex columns context-box">
            <div>
                <div>Variable Enviroment</div>
                <hr/>
            </div>
            <div class="flex columns">
                <div class="var-dclr flex rows">
                    <div class="var-title">num:</div>
                    <div class="var-value">0</div>
                </div>
                <div class="var-dclr flex rows">
                        <div class="var-title">add2:</div>
                        <div class="var-value function"></div>
                </div>
                <div class="var-dclr flex rows">
                        <div class="var-title">result1:</div>
                        <div class="var-value">_____</div>
                </div>
            </div>
        </div>
    </div>

---
template: localExec
```
const num = 0;
function add2(input){ // input = 2
    const result = input + 2;
*   return result;
}
*const result1 = add2(2); // 4
const result2 = add2(8);
```
<div class="execution-context flex rows spaces-around">
        <div class="thread-context flex columns context-box">
            <div>
                <div>Thread</div>
                <hr/>
            </div>
            <div class="flex columns">
                <div>const num = 0</div>
                <div>function add2(...)</div>
                <div>const result1 = add2(2)</div>
                <div class="execution-context nested-context garbage-context flex rows spaces-around">
                        <div class="thread-context flex columns context-box">
                                <div>
                                    <div>Thread</div>
                                    <hr/>
                                    <div class="flex columns">
                                        <div>input = 2</div>
                                        <div>const result = 2 + 2</div>
                                    </div>
                                </div>
                        </div>
                        <div class="var-env flex columns context-box">
                                <div>
                                    <div>Memory</div>
                                    <hr/>
                                </div>
                                <div class="flex columns">
                                        <div class="var-dclr flex rows">
                                            <div class="var-title">input:</div>
                                            <div class="var-value">2</div>
                                        </div>
                                        <div class="var-dclr flex rows">
                                                <div class="var-title">result:</div>
                                                <div class="var-value">4</div>
                                        </div>
                                </div>
                        </div>
                </div>
            </div>
        </div>
        <div class="var-env flex columns context-box">
            <div>
                <div>Variable Enviroment</div>
                <hr/>
            </div>
            <div class="flex columns">
                <div class="var-dclr flex rows">
                    <div class="var-title">num:</div>
                    <div class="var-value">0</div>
                </div>
                <div class="var-dclr flex rows">
                        <div class="var-title">add2:</div>
                        <div class="var-value function"></div>
                </div>
                <div class="var-dclr flex rows">
                        <div class="var-title">result1:</div>
                        <div class="var-value">4</div>
                </div>
            </div>
        </div>
    </div>

---
template: localExec

```
const num = 0;
function add2(input){
    const result = input + 2;
    return result;
}
const result1 = add2(2);
*const result2 = add2(8);
```
<div class="execution-context flex rows spaces-around">
        <div class="thread-context flex columns context-box">
            <div>
                <div>Thread</div>
                <hr/>
            </div>
            <div class="flex columns">
                <div>const num = 0</div>
                <div>function add2(...)</div>
                <div>const result1 = add2(2)</div>
                <div class="execution-context nested-context garbage-context flex rows spaces-around">
                        <div class="thread-context flex columns context-box">
                                <div>
                                    <div>Thread</div>
                                    <hr/>
                                    <div class="flex columns">
                                        <div>input = 2</div>
                                        <div>const result = 2 + 2</div>
                                    </div>
                                </div>
                        </div>
                        <div class="var-env flex columns context-box">
                                <div>
                                    <div>Memory</div>
                                    <hr/>
                                </div>
                                <div class="flex columns">
                                        <div class="var-dclr flex rows">
                                            <div class="var-title">input:</div>
                                            <div class="var-value">2</div>
                                        </div>
                                        <div class="var-dclr flex rows">
                                                <div class="var-title">result:</div>
                                                <div class="var-value">4</div>
                                        </div>
                                </div>
                        </div>
                </div>
                <div>const result2 = add2(8)</div>
            </div>
        </div>
        <div class="var-env flex columns context-box">
            <div>
                <div>Variable Enviroment</div>
                <hr/>
            </div>
            <div class="flex columns">
                <div class="var-dclr flex rows">
                    <div class="var-title">num:</div>
                    <div class="var-value">0</div>
                </div>
                <div class="var-dclr flex rows">
                    <div class="var-title">add2:</div>
                    <div class="var-value function"></div>
                </div>
                <div class="var-dclr flex rows">
                    <div class="var-title">result1:</div>
                    <div class="var-value">4</div>
                </div>
                <div class="var-dclr flex rows">
                    <div class="var-title">result2:</div>
                    <div class="var-value">_____</div>
                </div>
            </div>
        </div>
    </div>

---
template: localExec
```
const num = 0;
*function add2(input){ // input = 8
    const result = input + 2;
    return result;
}
const result1 = add2(2);
const result2 = add2(8);
```
<div class="execution-context flex rows spaces-around">
        <div class="thread-context flex columns context-box">
            <div>
                <div>Thread</div>
                <hr/>
            </div>
            <div class="flex columns">
                <div>const num = 0</div>
                <div>function add2(...)</div>
                <div>const result1 = add2(2)</div>
                <div class="execution-context nested-context garbage-context flex rows spaces-around">
                        <div class="thread-context flex columns context-box">
                                <div>
                                    <div>Thread</div>
                                    <hr/>
                                    <div class="flex columns">
                                        <div>input = 2</div>
                                        <div>const result = 2 + 2</div>
                                    </div>
                                </div>
                        </div>
                        <div class="var-env flex columns context-box">
                                <div>
                                    <div>Memory</div>
                                    <hr/>
                                </div>
                                <div class="flex columns">
                                        <div class="var-dclr flex rows">
                                            <div class="var-title">input:</div>
                                            <div class="var-value">2</div>
                                        </div>
                                        <div class="var-dclr flex rows">
                                                <div class="var-title">result:</div>
                                                <div class="var-value">4</div>
                                        </div>
                                </div>
                        </div>
                </div>
                <div>const result2 = add2(8)</div>
                <div class="execution-context nested-context flex rows spaces-around">
                        <div class="thread-context flex columns context-box">
                                <div>
                                    <div>Thread</div>
                                    <hr/>
                                    <div class="flex columns">
                                        <div>input = 8</div>
                                    </div>
                                </div>
                        </div>
                        <div class="var-env flex columns context-box">
                                <div>
                                    <div>Memory</div>
                                    <hr/>
                                </div>
                                <div class="flex columns">
                                        <div class="var-dclr flex rows">
                                            <div class="var-title">input:</div>
                                            <div class="var-value">8</div>
                                        </div>
                                </div>
                        </div>
                </div>
            </div>
        </div>
        <div class="var-env flex columns context-box">
            <div>
                <div>Variable Enviroment</div>
                <hr/>
            </div>
            <div class="flex columns">
                <div class="var-dclr flex rows">
                    <div class="var-title">num:</div>
                    <div class="var-value">0</div>
                </div>
                <div class="var-dclr flex rows">
                    <div class="var-title">add2:</div>
                    <div class="var-value function"></div>
                </div>
                <div class="var-dclr flex rows">
                    <div class="var-title">result1:</div>
                    <div class="var-value">4</div>
                </div>
                <div class="var-dclr flex rows">
                    <div class="var-title">result2:</div>
                    <div class="var-value">_____</div>
                </div>
            </div>
        </div>
    </div>

---
template: localExec
```
const num = 0;
function add2(input){ // input = 8
*   const result = input + 2; // 8 + 2 = 10
    return result;
}
const result1 = add2(2);
const result2 = add2(8);
```
<div class="execution-context flex rows spaces-around">
        <div class="thread-context flex columns context-box">
            <div>
                <div>Thread</div>
                <hr/>
            </div>
            <div class="flex columns">
                <div>const num = 0</div>
                <div>function add2(...)</div>
                <div>const result1 = add2(2)</div>
                <div class="execution-context nested-context garbage-context flex rows spaces-around">
                        <div class="thread-context flex columns context-box">
                                <div>
                                    <div>Thread</div>
                                    <hr/>
                                    <div class="flex columns">
                                        <div>input = 2</div>
                                        <div>const result = 2 + 2</div>
                                    </div>
                                </div>
                        </div>
                        <div class="var-env flex columns context-box">
                                <div>
                                    <div>Memory</div>
                                    <hr/>
                                </div>
                                <div class="flex columns">
                                        <div class="var-dclr flex rows">
                                            <div class="var-title">input:</div>
                                            <div class="var-value">2</div>
                                        </div>
                                        <div class="var-dclr flex rows">
                                                <div class="var-title">result:</div>
                                                <div class="var-value">4</div>
                                        </div>
                                </div>
                        </div>
                </div>
                <div>const result2 = add2(8)</div>
                <div class="execution-context nested-context flex rows spaces-around">
                        <div class="thread-context flex columns context-box">
                                <div>
                                    <div>Thread</div>
                                    <hr/>
                                    <div class="flex columns">
                                        <div>input = 8</div>
                                        <div>result = 8 + 2</div>
                                    </div>
                                </div>
                        </div>
                        <div class="var-env flex columns context-box">
                                <div>
                                    <div>Memory</div>
                                    <hr/>
                                </div>
                                <div class="flex columns">
                                        <div class="var-dclr flex rows">
                                            <div class="var-title">input:</div>
                                            <div class="var-value">8</div>
                                        </div>
                                        <div class="var-dclr flex rows">
                                            <div class="var-title">result:</div>
                                            <div class="var-value">10</div>
                                        </div>
                                </div>
                        </div>
                </div>
            </div>
        </div>
        <div class="var-env flex columns context-box">
            <div>
                <div>Variable Enviroment</div>
                <hr/>
            </div>
            <div class="flex columns">
                <div class="var-dclr flex rows">
                    <div class="var-title">num:</div>
                    <div class="var-value">0</div>
                </div>
                <div class="var-dclr flex rows">
                    <div class="var-title">add2:</div>
                    <div class="var-value function"></div>
                </div>
                <div class="var-dclr flex rows">
                    <div class="var-title">result1:</div>
                    <div class="var-value">4</div>
                </div>
                <div class="var-dclr flex rows">
                    <div class="var-title">result2:</div>
                    <div class="var-value">_____</div>
                </div>
            </div>
        </div>
    </div>

---
template: localExec

```
const num = 0;
function add2(input){
    const result = input + 2;
*   return result; // 10
}
const result1 = add2(2);
*const result2 = add2(8); // 10

```
<div class="execution-context flex rows spaces-around">
        <div class="thread-context flex columns context-box">
            <div>
                <div>Thread</div>
                <hr/>
            </div>
            <div class="flex columns">
                <div>const num = 0</div>
                <div>function add2(...)</div>
                <div>const result1 = add2(2)</div>
                <div class="execution-context nested-context garbage-context flex rows spaces-around">
                        <div class="thread-context flex columns context-box">
                                <div>
                                    <div>Thread</div>
                                    <hr/>
                                    <div class="flex columns">
                                        <div>input = 2</div>
                                        <div>const result = 2 + 2</div>
                                    </div>
                                </div>
                        </div>
                        <div class="var-env flex columns context-box">
                                <div>
                                    <div>Memory</div>
                                    <hr/>
                                </div>
                                <div class="flex columns">
                                        <div class="var-dclr flex rows">
                                            <div class="var-title">input:</div>
                                            <div class="var-value">2</div>
                                        </div>
                                        <div class="var-dclr flex rows">
                                                <div class="var-title">result:</div>
                                                <div class="var-value">4</div>
                                        </div>
                                </div>
                        </div>
                </div>
                <div>const result2 = add2(8)</div>
                <div class="execution-context nested-context garbage-context flex rows spaces-around">
                        <div class="thread-context flex columns context-box">
                                <div>
                                    <div>Thread</div>
                                    <hr/>
                                    <div class="flex columns">
                                        <div>input = 8</div>
                                        <div>result = 8 + 2</div>
                                    </div>
                                </div>
                        </div>
                        <div class="var-env flex columns context-box">
                                <div>
                                    <div>Memory</div>
                                    <hr/>
                                </div>
                                <div class="flex columns">
                                        <div class="var-dclr flex rows">
                                            <div class="var-title">input:</div>
                                            <div class="var-value">8</div>
                                        </div>
                                        <div class="var-dclr flex rows">
                                            <div class="var-title">result:</div>
                                            <div class="var-value">10</div>
                                        </div>
                                </div>
                        </div>
                </div>
            </div>
        </div>
        <div class="var-env flex columns context-box">
            <div>
                <div>Variable Enviroment</div>
                <hr/>
            </div>
            <div class="flex columns">
                <div class="var-dclr flex rows">
                    <div class="var-title">num:</div>
                    <div class="var-value">0</div>
                </div>
                <div class="var-dclr flex rows">
                    <div class="var-title">add2:</div>
                    <div class="var-value function"></div>
                </div>
                <div class="var-dclr flex rows">
                    <div class="var-title">result1:</div>
                    <div class="var-value">4</div>
                </div>
                <div class="var-dclr flex rows">
                    <div class="var-title">result2:</div>
                    <div class="var-value">10</div>
                </div>
            </div>
        </div>
    </div>

---

template: syncJs
subTitle: ### On what execution context are we?

--
JavaScript needs to keep track on which execution context it is running.

--

## Enter the Call-Stack:
.center[![image of a stack](call_stack.png)]

---
layout: true
name: callStack
# Call Stack
---

```
*console.log('Hi!');
function greet(name){
    console.log('Hello ' + name);
}
greet("Sagiv");
console.log('Bye!');
```
<div class="execution-context flex rows spaces-around">
        <div class="call-stack-wrapper flex columns context-box">
            <div>
                <div class="execution-context-title">Call stack</div>
                <hr/>
            </div>
            <div class="call-stack flex columns">
                <div class="stack-item active">global()</div>
            </div>
        </div>
        <div class="thread-context flex columns context-box">
            <div>
                <div class="execution-context-title">Thread</div>
                <hr/>
            </div>
            <div class="flex columns">
                <div>console.log('Hi!')</div>
            </div>
        </div>
        <div class="var-env flex columns context-box">
            <div>
                <div class="execution-context-title">Variable Enviroment</div>
                <hr/>
            </div>
            <div class="flex columns">

            </div>
            <div class="console flex columns">
                <div>
                    <div class="execution-context-title">Console:</div>
                    <hr/>
                </div>
                <div>Hi!</div>
            </div>
        </div>
    </div>

---

```
console.log('Hi!');
*function greet(name){
    console.log('Hello ' + name);
}
greet("Sagiv");
console.log('Bye!');
```
<div class="execution-context flex rows spaces-around">
        <div class="call-stack-wrapper flex columns context-box">
            <div>
                <div class="execution-context-title">Call stack</div>
                <hr/>
            </div>
            <div class="call-stack flex columns">
                <div class="stack-item active">global()</div>
            </div>
        </div>
        <div class="thread-context flex columns context-box">
            <div>
                <div class="execution-context-title">Thread</div>
                <hr/>
            </div>
            <div class="flex columns">
                <div>console.log('Hi!')</div>
                <div>function greet(...)</div>
            </div>
        </div>
        <div class="var-env flex columns context-box">
            <div>
                <div class="execution-context-title">Variable Enviroment</div>
                <hr/>
            </div>
            <div class="flex columns">
                    <div class="var-dclr flex rows">
                            <div class="var-title">greet:</div>
                            <div class="var-value function"></div>
                    </div>
            </div>
            <div class="console flex columns">
                <div>
                    <div class="execution-context-title">Console:</div>
                    <hr/>
                </div>
                <div>Hi!</div>
            </div>
        </div>
    </div>
---

```
console.log('Hi!');
function greet(name){
    console.log('Hello ' + name);
}
*greet("Sagiv");
console.log('Bye!');
```
<div class="execution-context flex rows spaces-around">
    <div class="call-stack-wrapper flex columns context-box">
        <div>
            <div class="execution-context-title">Call stack</div>
            <hr/>
        </div>
        <div class="call-stack flex columns">
            <div class="stack-item active">global()</div>
        </div>
    </div>
    <div class="thread-context flex columns context-box">
        <div>
            <div class="execution-context-title">Thread</div>
            <hr/>
        </div>
        <div class="flex columns">
            <div>console.log('Hi!')</div>
            <div>function greet(...)</div>
            <div>greet("Sagiv")</div>
        </div>
    </div>
    <div class="var-env flex columns context-box">
        <div>
            <div class="execution-context-title">Variable Enviroment</div>
            <hr/>
        </div>
        <div class="flex columns">
                <div class="var-dclr flex rows">
                        <div class="var-title">greet:</div>
                        <div class="var-value function"></div>
                </div>
        </div>
        <div class="console flex columns">
            <div>
                <div class="execution-context-title">Console:</div>
                <hr/>
            </div>
            <div>Hi!</div>
        </div>
    </div>
</div>

---

```
console.log('Hi!');
*function greet(name){
    console.log('Hello ' + name);
}
greet("Sagiv");
console.log('Bye!');
```
<div class="execution-context flex rows spaces-around">
<div class="call-stack-wrapper flex columns context-box">
<div>
<div class="execution-context-title">Call stack</div>
<hr/>
</div>
<div class="call-stack flex columns">
<div class="stack-item active">greet()</div>
<div class="stack-item">global()</div>
</div>
</div>
<div class="thread-context flex columns context-box">
<div>
<div class="execution-context-title">Thread</div>
<hr/>
</div>
<div class="flex columns">
<div>console.log('Hi!')</div>
<div>function greet(...)</div>
<div>greet("Sagiv")</div>

<div class="execution-context nested-context flex rows spaces-around">
<div class="thread-context flex columns context-box">
    <div>
        <div class="execution-context-title">Thread</div>
        <hr/>
    </div>
    <div class="flex columns">
        <div>name = "Sagiv"</div>
    </div>
</div>
<div class="var-env flex columns context-box">
    <div>
        <div class="execution-context-title">memory</div>
        <hr/>
    </div>
    <div class="flex columns">
            <div class="var-dclr flex rows">
                    <div class="var-title">name:</div>
                    <div class="var-value">"Sagiv"</div>
            </div>
    </div>
</div>
</div>
</div>
</div>
<div class="var-env flex columns context-box">
<div>
<div class="execution-context-title">Variable Enviroment</div>
<hr/>
</div>
<div class="flex columns">
    <div class="var-dclr flex rows">
            <div class="var-title">greet:</div>
            <div class="var-value function"></div>
    </div>
</div>
<div class="console flex columns">
<div>
    <div class="execution-context-title">Console:</div>
    <hr/>
</div>
<div>Hi!</div>
</div>
</div>
</div>

---

```
console.log('Hi!');
function greet(name){
*   console.log('Hello ' + name);
}
greet("Sagiv");
console.log('Bye!');
```
<div class="execution-context flex rows spaces-around">
    <div class="call-stack-wrapper flex columns context-box">
        <div>
            <div class="execution-context-title">Call stack</div>
            <hr/>
        </div>
        <div class="call-stack flex columns">
            <div class="stack-item active">greet()</div>
            <div class="stack-item">global()</div>
        </div>
    </div>
    <div class="thread-context flex columns context-box">
        <div>
            <div class="execution-context-title">Thread</div>
            <hr/>
        </div>
        <div class="flex columns">
            <div>console.log('Hi!')</div>
            <div>function greet(...)</div>
            <div>greet("Sagiv")</div>
            <div class="execution-context nested-context flex rows spaces-around">
                <div class="thread-context flex columns context-box">
                    <div>
                        <div class="execution-context-title">Thread</div>
                        <hr/>
                    </div>
                    <div class="flex columns">
                        <div>name = "Sagiv"</div>
                    </div>
                </div>
                <div class="var-env flex columns context-box">
                    <div>
                        <div class="execution-context-title">memory</div>
                        <hr/>
                    </div>
                    <div class="flex columns">
                            <div class="var-dclr flex rows">
                                    <div class="var-title">name:</div>
                                    <div class="var-value">"Sagiv"</div>
                            </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="var-env flex columns context-box">
        <div>
            <div class="execution-context-title">Variable Enviroment</div>
            <hr/>
        </div>
        <div class="flex columns">
                <div class="var-dclr flex rows">
                        <div class="var-title">greet:</div>
                        <div class="var-value function"></div>
                </div>
        </div>
        <div class="console flex columns">
            <div>
                <div class="execution-context-title">Console:</div>
                <hr/>
            </div>
            <div>Hi!</div>
            <div>Hello Sagiv</div>
        </div>
    </div>
</div>

---

```
console.log('Hi!');
function greet(name){
    console.log('Hello ' + name);
}
greet("Sagiv");
*console.log('Bye!');
```
<div class="execution-context flex rows spaces-around">
    <div class="call-stack-wrapper flex columns context-box">
        <div>
            <div class="execution-context-title">Call stack</div>
            <hr/>
        </div>
        <div class="call-stack flex columns">
            <div class="stack-item active">global()</div>
        </div>
    </div>
    <div class="thread-context flex columns context-box">
        <div>
            <div class="execution-context-title">Thread</div>
            <hr/>
        </div>
        <div class="flex columns">
            <div>console.log('Hi!')</div>
            <div>function greet(...)</div>
            <div>greet("Sagiv")</div>
            <div class="execution-context nested-context garbage-context flex rows spaces-around">
                <div class="thread-context flex columns context-box">
                    <div>
                        <div class="execution-context-title">Thread</div>
                        <hr/>
                    </div>
                    <div class="flex columns">
                        <div>name = "Sagiv"</div>
                    </div>
                </div>
                <div class="var-env flex columns context-box">
                    <div>
                        <div class="execution-context-title">memory</div>
                        <hr/>
                    </div>
                    <div class="flex columns">
                            <div class="var-dclr flex rows">
                                    <div class="var-title">name:</div>
                                    <div class="var-value">"Sagiv"</div>
                            </div>
                    </div>
                </div>
            </div>
            <div>console.log('Bye!')</div>
        </div>
    </div>
    <div class="var-env flex columns context-box">
        <div>
            <div class="execution-context-title">Variable Enviroment</div>
            <hr/>
        </div>
        <div class="flex columns">
                <div class="var-dclr flex rows">
                        <div class="var-title">greet:</div>
                        <div class="var-value function"></div>
                </div>
        </div>
        <div class="console flex columns">
            <div>
                <div class="execution-context-title">Console:</div>
                <hr/>
            </div>
            <div>Hi!</div>
            <div>Hello Sagiv</div>
            <div>Bye!</div>
        </div>
    </div>
</div>

---
layout:true
name: syncExecutionCode
mark1:
mark2:
mark3:
mark4:
mark5:
mark6:
# Synchronous Execution Limitations
```
{{mark1}}const displayUser = (user) => console.log(user);

{{mark2}}const userFromServer = fetchSync("http://domain.com/user/sagiv");

{{mark3}}// We must wait for the data in order to use it later.
{{mark4}}// So, we are waiting... Â¯\_(ãƒ„)_/Â¯

{{mark5}}displayUser(userFromServer);

{{mark6}}console.log('What took you so long?!');
```
---

mark1: *
---
mark2:*
---
mark3:*
---
mark4:*
---
mark5:*
---
mark1:*
---
mark6:*
---
### We have 3 main goals:

--

1. To be able to run tasks that takes a long time to complete.

--

2. While runing our slow tasks, continue running our javascript code.

--

3. On completion of our slow task, to be able to run functionality that uses the data recieved from it. 

---
template: questions
---
template: chapter
number: 2
title: [A]synchronous Execution
subtitle: The Browser API

---
layout: true
name: asyncjs
mainTitle: Asynchronous Execution
mark1:
mark2:
mark3:
mark4:
mark5:
mark6:
summary:
hideSummary: hide
callStackMethods:
threadCommnads:
memoryVariables:
consoleLogs:
# {{mainTitle}}
<small class="summary {{hideSummary}}">{{summary}}</small>

```
{{mark1}}const printHello = () => console.log('hello');
{{mark2}}const logUser = (user) => console.log(user);

{{mark3}}console.log(1);

{{mark4}}setTimeout(printHello,0);

{{mark5}}logUser('sagiv');

{{mark6}}console.log(2);
```
</div>  

<div class="execution-context flex rows spaces-around">
    <div class="call-stack-wrapper flex columns context-box">
        <div>
            <div class="execution-context-title">Call stack</div>
            <hr/>
        </div>
        <div class="call-stack flex columns">
            {{callStackMethods}}
            <div class="stack-item active">global()</div>
        </div>
    </div>
    <div class="thread-context flex columns context-box">
        <div>
            <div class="execution-context-title">Thread</div>
            <hr/>
        </div>
        <div class="flex columns">
            <!-- <div>console.log('Hi!')</div> -->
            {{threadCommnads}}
        </div>
    </div>
    <div class="var-env flex columns context-box">
        <div>
            <div class="execution-context-title">Variable Enviroment</div>
            <hr/>
        </div>
        <div class="flex columns">
            <!-- <div class="var-dclr flex rows">
                <div class="var-title">printHello:</div>
                <div class="var-value function"></div>
            </div> -->
            {{memoryVariables}}
        </div>
        <div class="console flex columns">
            <div>
                <div class="execution-context-title">Console:</div>
                <hr/>
            </div>
            <!-- <div>Hi!</div> -->
            {{consoleLogs}}
        </div>
    </div>
</div>
---
template: asyncjs
---

template: asyncjs
mark1:*
memoryVariables:<div class="var-dclr flex rows"><div class="var-title">printHello:</div><div class="var-value function"></div></div>               
---

template: asyncjs
mark2:*
memoryVariables:<div class="var-dclr flex rows"><div class="var-title">printHello:</div><div class="var-value function"></div></div><div class="var-dclr flex rows"><div class="var-title">logUser:</div><div class="var-value function"></div></div>                 
---

template: asyncjs
mark3:*
threadCommnads:<div>console.log(1)</div>
memoryVariables:<div class="var-dclr flex rows"><div class="var-title">printHello:</div><div class="var-value function"></div></div><div class="var-dclr flex rows"><div class="var-title">logUser:</div><div class="var-value function"></div></div>
consoleLogs:<div><small>1ms: </small>1</div>
---

template: asyncjs
mark4:*
threadCommnads:<div>console.log(1)</div><div>setTimeout(printHello,0)</div>
memoryVariables:<div class="var-dclr flex rows"><div class="var-title">printHello:</div><div class="var-value function"></div></div><div class="var-dclr flex rows"><div class="var-title">logUser:</div><div class="var-value function"></div></div>
consoleLogs:<div><small>1ms: </small>1</div>
---

template: asyncjs
mark2:*
mark5:*
callStackMethods:<div class="stack-item active">logUser()</div>
threadCommnads:<div>console.log(1)</div><div>setTimeout(printHello,0)</div><div>logUser('Sagiv')</div>
memoryVariables:<div class="var-dclr flex rows"><div class="var-title">printHello:</div><div class="var-value function"></div></div><div class="var-dclr flex rows"><div class="var-title">logUser:</div><div class="var-value function"></div></div>
consoleLogs:<div><small>1ms: </small>1</div><div><small>4ms: </small>Sagiv</div>
---

template: asyncjs
mark6:*
threadCommnads:<div>console.log(1)</div><div>setTimeout(printHello,0)</div><div>logUser('Sagiv')</div><div>console.log(2)</div>
memoryVariables:<div class="var-dclr flex rows"><div class="var-title">printHello:</div><div class="var-value function"></div></div><div class="var-dclr flex rows"><div class="var-title">logUser:</div><div class="var-value function"></div></div>
consoleLogs:<div><small>1ms: </small>1</div><div><small>4ms: </small>Sagiv</div><div><div><small>6ms: </small>2</div>
---

template: asyncjs
mark1:*
callStackMethods:<div class="stack-item active">printHello()</div>
threadCommnads:<div>console.log(1)</div><div>setTimeout(printHello,0)</div><div>logUser('Sagiv')</div><div>console.log(2)</div><div>printHello()</div>
memoryVariables:<div class="var-dclr flex rows"><div class="var-title">printHello:</div><div class="var-value function"></div></div><div class="var-dclr flex rows"><div class="var-title">logUser:</div><div class="var-value function"></div></div>
consoleLogs:<div><small>1ms: </small>1</div><div><small>4ms: </small>Sagiv</div><div><div><small>6ms: </small>2</div><div><small>10ms: </small>hello</div>
---

template: asyncjs
threadCommnads:<div>console.log(1)</div><div>setTimeout(printHello,0)</div><div>logUser('Sagiv')</div><div>console.log(2)</div><div>printHello()</div>
memoryVariables:<div class="var-dclr flex rows"><div class="var-title">printHello:</div><div class="var-value function"></div></div><div class="var-dclr flex rows"><div class="var-title">logUser:</div><div class="var-value function"></div></div>
consoleLogs:<div><small>1ms: </small>1</div><div><small>4ms: </small>Sagiv</div><div><div><small>6ms: </small>2</div><div><small>10ms: </small>hello</div>
hideSummary:
summary: This model of javascript isn't enough for us to understand the async nature of our code, <br> Something is missing.
---

layout: false
# Browser API / Features
<small>The browser provides us many features to handle code <b class="emphesize">OUTSIDE</b> of javascript</small>
- <span class="emphesize">DOM</span> (Document Object Model)
- <span class="emphesize">Timer</span> (WindowOrWorkerGlobalScope)
- <span class="emphesize">XHR</span> (Xml Http Request)
- <span class="emphesize">fetch</span> (WindowOrWorkerGlobalScope)
- <span class="emphesize">local storage</span>
- <span class="emphesize">console</span>
- And a lot more...

<a class="external-link" href="https://developer.mozilla.org/en-US/docs/Web/API" target="_blank">
    developer.mozilla.org/en-US/docs/Web/API
</a>

---

layout:true
name: browser API
template: asyncjs
mainTitle: Browser API (Features)
BrowserFeature:
browserTime:
browserCallbackName:
browserStatus:
cbTaskHiddenClass: transparent
eventLoopHiddenClass: hide
taskClass: hide
microTaskClass: hide
<hr style="border-color: #ff4242; margin: 5px 0" />
<div class="browser-api flex">
    <div class="event-loop-spinner-wrapper {{eventLoopHiddenClass}} flex">
        <div class="event-loop-spinner "></div>
    </div>
    <div class="ques-wrapper flex rows">
        <div class="que-wrapper {{microTaskClass}}">
            <div class="que-title">Micro Task Que</div>
            <div class="micro-task-que que">
                <div class="task micro-task active ">promise</div>
                <div class="task micro-task">promise2</div>
            </div>
        </div>
        <div class="que-wrapper {{taskClass}}">
            <div class="que-title">Task Que (Callback Que)</div>
            <div class="task-que que">
                <div class="task callback-task {{cbTaskHiddenClass}}">printHello()</div>
            </div>
        </div>  
    </div>
    <div class="browser-evnviroment">
        <div class="browser-api-title">Browser API</div>
        <div class="browser-api-content">
            <div>{{BrowserFeature}}</div>
            <div>{{browserTime}}</div>
            <div>{{browserCallbackName}}</div>
            <br>
            <div>{{browserStatus}}</div>
        </div>
    </div>
</div>
 
---

template: brows API
mark1:*
memoryVariables:<div class="var-dclr flex rows"><div class="var-title">printHello:</div><div class="var-value function"></div></div>

---

template: brows API
mark2:*
memoryVariables:<div class="var-dclr flex rows"><div class="var-title">printHello:</div><div class="var-value function"></div></div><div class="var-dclr flex rows"><div class="var-title">logUser:</div><div class="var-value function"></div></div>

---

template: brows API
mark3:*
threadCommnads:<div>console.log(1)</div>
memoryVariables:<div class="var-dclr flex rows"><div class="var-title">printHello:</div><div class="var-value function"></div></div><div class="var-dclr flex rows"><div class="var-title">logUser:</div><div class="var-value function"></div></div>
consoleLogs:<div><small>1ms: </small>1</div>

---

template: brows API
mark4:*
threadCommnads:<div>console.log(1)</div><div>setTimeout(printHello,0)</div>
memoryVariables:<div class="var-dclr flex rows"><div class="var-title">printHello:</div><div class="var-value function"></div></div><div class="var-dclr flex rows"><div class="var-title">logUser:</div><div class="var-value function"></div></div>
consoleLogs:<div><small>1ms: </small>1</div>
BrowserFeature: Timer
browserTime: 0ms
browserCallbackName: printHello
browserStatus: Complete: false

---

template: brows API
mark2:*
mark5:*
callStackMethods:<div class="stack-item active">logUser()</div>
threadCommnads:<div>console.log(1)</div><div>setTimeout(printHello,0)</div><div>logUser('Sagiv')</div>
memoryVariables:<div class="var-dclr flex rows"><div class="var-title">printHello:</div><div class="var-value function"></div></div><div class="var-dclr flex rows"><div class="var-title">logUser:</div><div class="var-value function"></div></div>
consoleLogs:<div><small>1ms: </small>1</div><div><small>4ms: </small>Sagiv</div>
cbTaskHiddenClass:
taskClass:
BrowserFeature: Timer
browserTime:0ms
browserCallbackName: printHello
browserStatus: Complete: true

---

template: brows API
mark6:*
threadCommnads:<div>console.log(1)</div><div>setTimeout(printHello,0)</div><div>logUser('Sagiv')</div>
memoryVariables:<div class="var-dclr flex rows"><div class="var-title">printHello:</div><div class="var-value function"></div></div><div class="var-dclr flex rows"><div class="var-title">logUser:</div><div class="var-value function"></div></div>
consoleLogs:<div><small>1ms: </small>1</div><div><small>4ms: </small>Sagiv</div><div><small>6ms: </small>2</div>
cbTaskHiddenClass:
taskClass:
eventLoopHiddenClass:
BrowserFeature: Timer
browserTime:0ms
browserCallbackName: printHello
browserStatus: Complete: true

---

template: brows API
threadCommnads:<div>console.log(1)</div><div>setTimeout(printHello,0)</div><div>logUser('Sagiv')</div>
memoryVariables:<div class="var-dclr flex rows"><div class="var-title">printHello:</div><div class="var-value function"></div></div><div class="var-dclr flex rows"><div class="var-title">logUser:</div><div class="var-value function"></div></div>
consoleLogs:<div><small>1ms: </small>1</div><div><small>4ms: </small>Sagiv</div><div><small>6ms: </small>2</div>
cbTaskHiddenClass:
taskClass:
eventLoopHiddenClass:
BrowserFeature: Timer
browserTime:0ms
browserCallbackName: printHello
browserStatus: Complete: true

---

template: brows API
mark1:*
taskClass:
eventLoopHiddenClass:
callStackMethods:<div class="stack-item active">printHello()</div>
threadCommnads:<div>console.log(1)</div><div>setTimeout(printHello,0)</div><div>logUser('Sagiv')</div>
memoryVariables:<div class="var-dclr flex rows"><div class="var-title">printHello:</div><div class="var-value function"></div></div><div class="var-dclr flex rows"><div class="var-title">logUser:</div><div class="var-value function"></div></div>
consoleLogs:<div><small>1ms: </small>1</div><div><small>4ms: </small>Sagiv</div><div><small>6ms: </small>2</div><div><small>10ms: </small>hello</div>

---

template: brows API
taskClass:
eventLoopHiddenClass:
threadCommnads:<div>console.log(1)</div><div>setTimeout(printHello,0)</div><div>logUser('Sagiv')</div>
memoryVariables:<div class="var-dclr flex rows"><div class="var-title">printHello:</div><div class="var-value function"></div></div><div class="var-dclr flex rows"><div class="var-title">logUser:</div><div class="var-value function"></div></div>
consoleLogs:<div><small>1ms: </small>1</div><div><small>4ms: </small>Sagiv</div><div><small>6ms: </small>2</div><div><small>10ms: </small>hello</div>
---
template: questions
---

template: chapter
number: 3
title: I'll fetch, that's a Promise!
subtitle: Wearing 2 hats

---
layout: true
name: promise
mark1:
mark2:
mark3:
mark4:
mark5:
mark6:
mark7:
mark8:
# Promise
```
{{mark1}}function displayUser(user) { console.log(user); }
{{mark2}}function printHello() { console.log('hello'); }
{{mark3}}function block500ms() { /* some blocking logic for 500ms (while loop?) */ }

{{mark4}}setTimeout(printHello, 0);

{{mark5}}const userFromServer = fetch('https://d.com/user/1'); // returns 'sagiv'
{{mark6}}userFromServer.then(displayUser);

{{mark7}}block500ms();

{{mark8}}console.log('global')

```
---

template: promise
---

layout: true
name: promise context
class: promise-context
template: promise
memoryVariables:
consoleLogs:
threadCommnads:
callStackMethods:
cbTaskHiddenClass: transparent
taskClass:
eventLoopHiddenClass:
microTaskClass: hide
microTaskQueClass: transparent
BrowserFeature:
browserTime:
browserCallbackName:
browserStatus:

displayUser: transparent
printHello: transparent
block500ms: transparent
promiseObj: transparent
promiseThen: transparent
timer: transparent
timerStatus: false
xhr: transparent
xhrStatus: false

<div class="execution-context flex rows spaces-around">
        <div class="call-stack-wrapper flex columns context-box">
            <div>
                <div class="execution-context-title">Call stack</div>
                <hr/>
            </div>
            <div class="call-stack flex columns">
                {{callStackMethods}}
                <div class="stack-item active">global()</div>
            </div>
        </div>
        <div class="thread-context flex columns context-box">
            <div>
                <div class="execution-context-title">Thread</div>
                <hr/>
            </div>
            <div class="flex columns">
                <!-- <div>console.log('Hi!')</div> -->
                {{threadCommnads}}
            </div>
        </div>
        <div class="var-env flex columns context-box">
            <div>
                <div class="execution-context-title">Variable Enviroment</div>
                <hr/>
            </div>
            <div class="flex columns">
                <div class="var-dclr flex rows {{displayUser}}">
                    <div class="var-title">displayUser:</div>
                    <div class="var-value function"></div>
                </div>
                <div class="var-dclr flex rows {{printHello}}">
                    <div class="var-title">printHello:</div>
                    <div class="var-value function"></div>
                </div>
                <div class="var-dclr flex rows {{block500ms}}">
                    <div class="var-title">block500ms:</div>
                    <div class="var-value function"></div>
                </div>
                <div class="var-dclr flex columns">
                    <div style="align-self: baseline" class="flex rows {{promiseObj}}">
                        <div class="var-title">userFromServer:</div>
                        <div class="var-value promise">{ P }</div>
                    </div>
                    <div style="width:100%" class="{{promiseThen}}">[ displayUser ]</div>
                </div>
            </div>
            <div class="console flex columns">
                <div>
                    <div class="execution-context-title">Console:</div>
                    <hr/>
                </div>
                <!-- <div>Hi!</div> -->
                {{consoleLogs}}
            </div>
        </div>
    </div>
<hr style="border-color: #ff4242; margin: 5px 0" />
<div class="browser-api flex">
    <div class="event-loop-spinner-wrapper {{eventLoopHiddenClass}} flex">
        <div class="event-loop-spinner "></div>
    </div>
    <div class="ques-wrapper flex rows">
        <div class="que-wrapper {{microTaskClass}}">
            <div class="que-title">Micro Task Que</div>
            <div class="micro-task-que que">
                <div class="task micro-task active {{microTaskQueClass}}">displayUser()</div>
                <!-- <div class="task micro-task">promise2</div> -->
            </div>
        </div>
        <div class="que-wrapper {{taskClass}}">
            <div class="que-title">Task Que (Callback Que)</div>
            <div class="task-que que">
                <div class="task callback-task {{cbTaskHiddenClass}}">printHello()</div>
            </div>
        </div>  
    </div>
    <div class="browser-evnviroment">
        <div class="browser-api-title">Browser API</div>
        <div class="browser-api-content {{timer}}">
            <div>Feature: Timer</div>
            <div>Wait: 0ms</div>
            <div>Callback: printHello</div>
            <div>Complete: {{timerStatus}}</div>
        </div>
        <hr class="{{xhr}}"/>
        <div class="browser-api-content {{xhr}}">
            <div>Feature: XHR</div>
            <div>URL: https://d.com/user/1</div>
            <div>Method: GET</div>
            <div>On Complete: displayUser</div>
            <div>Complete: {{xhrStatus}}</div>
        </div>
    </div>
</div>
---

template: promise context
mark1: *
threadCommnads: <div>function displayUser(...</div>
displayUser:

---

template: promise context
mark2: *
threadCommnads: <div>function displayUser(...</div><div>function printHello(...</div>
displayUser:
printHello:

---

template: promise context
mark3: *
threadCommnads: <div>function displayUser(...</div><div>function printHello(...</div><div>function block500ms(...</div>
displayUser:
printHello:
block500ms:

---

template: promise context
mark4: *
threadCommnads: <div>function displayUser(...</div><div>function printHello(...</div><div>function block500ms(...</div><div>setTimeout(printHello, 0)</div>
displayUser:
printHello:
block500ms:
timer:
taskClass:
---

template: promise context
mark5: *
threadCommnads: <div>function displayUser(...</div><div>function printHello(...</div><div>function block500ms(...</div><div>setTimeout(printHello, 0)</div><div>const userFromServer = fetch('https://d.com/user/1')</div>
displayUser:
printHello:
block500ms:
promiseObj:
timer:
timerStatus: true
taskClass:
cbTaskHiddenClass:
xhr:

---

template: promise context
mark6: *
threadCommnads: <div>function displayUser(...</div><div>function printHello(...</div><div>function block500ms(...</div><div>setTimeout(printHello, 0)</div><div>const userFromServer = fetch('https://d.com/user/1')</div>
displayUser:
printHello:
block500ms:
promiseObj:
timer:
timerStatus: true
taskClass:
cbTaskHiddenClass:
xhr:
promiseThen:

---

template: promise context
mark7: *
threadCommnads: <div>function displayUser(...</div><div>function printHello(...</div><div>function block500ms(...</div><div>setTimeout(printHello, 0)</div><div>const userFromServer = fetch('https://d.com/user/1')</div><div>block500ms()</div>
displayUser:
printHello:
block500ms:
promiseObj:
timer:
timerStatus: true
taskClass:
cbTaskHiddenClass:
xhr:
promiseThen:

---

template: promise context
mark8: *
threadCommnads: <div>function displayUser(...</div><div>function printHello(...</div><div>function block500ms(...</div><div>setTimeout(printHello, 0)</div><div>const userFromServer = fetch('https://d.com/user/1')</div><div>block500ms()</div>
displayUser:
printHello:
block500ms:
promiseObj:
timer:
timerStatus: true
taskClass:
cbTaskHiddenClass:
xhr:
promiseThen:
xhrStatus: true
consoleLogs: <div>global</div>

---

template: promise context
threadCommnads: <div>function displayUser(...</div><div>function printHello(...</div><div>function block500ms(...</div><div>setTimeout(printHello, 0)</div><div>const userFromServer = fetch('https://d.com/user/1')</div><div>block500ms()</div>
displayUser:
printHello:
block500ms:
promiseObj:
timer:
timerStatus: true
taskClass:
microTaskClass:
microTaskQueClass:
cbTaskHiddenClass:
xhr:
promiseThen:
xhrStatus: true
consoleLogs: <div>global</div>
---

template: promise context
mark1: *
threadCommnads: <div>function displayUser(...</div><div>function printHello(...</div><div>function block500ms(...</div><div>setTimeout(printHello, 0)</div><div>const userFromServer = fetch('https://d.com/user/1')</div><div>block500ms()</div><div>displayUser(sagiv)</div><div>**EXECUTION CONTEXT **</div>
displayUser:
printHello:
block500ms:
promiseObj:
timer:
timerStatus: true
taskClass:
microTaskClass:
cbTaskHiddenClass:
xhr:
promiseThen:
consoleLogs: <div>global</div><div>sagiv</div>
callStackMethods: <div class="stack-item active">displayUser()</div>

---

template: promise context
threadCommnads: <div>function displayUser(...</div><div>function printHello(...</div><div>function block500ms(...</div><div>setTimeout(printHello, 0)</div><div>const userFromServer = fetch('https://d.com/user/1')</div><div>block500ms()</div><div>displayUser(sagiv)</div>
displayUser:
printHello:
block500ms:
promiseObj:
timer:
timerStatus: true
taskClass:
microTaskClass:
cbTaskHiddenClass:
xhr:
promiseThen:
consoleLogs: <div>global</div><div>sagiv</div>
callStackMethods:

---

mark2: *
template: promise context
threadCommnads: <div>function displayUser(...</div><div>function printHello(...</div><div>function block500ms(...</div><div>setTimeout(printHello, 0)</div><div>const userFromServer = fetch('https://d.com/user/1')</div><div>block500ms()</div><div>displayUser(sagiv)</div><div>printHello()</div><div>**EXECUTION CONTEXT **</div>
displayUser:
printHello:
block500ms:
promiseObj:
timer:
timerStatus: true
taskClass:
microTaskClass:

xhr:
promiseThen:
consoleLogs: <div>global</div><div>sagiv</div>
callStackMethods: <div class="stack-item active">printHello()</div>

---

mark2: *
template: promise context
threadCommnads: <div>function displayUser(...</div><div>function printHello(...</div><div>function block500ms(...</div><div>setTimeout(printHello, 0)</div><div>const userFromServer = fetch('https://d.com/user/1')</div><div>block500ms()</div><div>displayUser(sagiv)</div><div>printHello()</div><div>**EXECUTION CONTEXT **</div>
displayUser:
printHello:
block500ms:
promiseObj:
timer:
timerStatus: true
taskClass:
microTaskClass:

xhr:
promiseThen:
consoleLogs: <div>global</div><div>sagiv</div><div>hello</div>
callStackMethods: <div class="stack-item active">printHello()</div>

---

template: promise context
threadCommnads: <div>function displayUser(...</div><div>function printHello(...</div><div>function block500ms(...</div><div>setTimeout(printHello, 0)</div><div>const userFromServer = fetch('https://d.com/user/1')</div><div>block500ms()</div><div>displayUser(sagiv)</div><div>printHello()</div>
displayUser:
printHello:
block500ms:
promiseObj:
timer:
timerStatus: true
taskClass:
microTaskClass:

xhr:
promiseThen:
consoleLogs: <div>global</div><div>sagiv</div><div>hello</div>
callStackMethods:

---
template: questions
---
template: chapter
number: 4
title: Closure
subtitle: The Return Of The Function

---
layout: true
name: returning a function
mark1:
mark2:
mark3:
mark4:
mark5:
mark6:
mark7:
mark8:
callInnerFunction: // add2(5) throws the undefined error

memoFuncGenerator: hide
memoGeneratedFunc:hide
memoResult:hide
memoResultVal:
callstackGlobal:
callStackGeneratedFunc: hide
callStackfuncGenerator: hide
executionFuncGenerator: hide
executionGeneratedFunc: hide
executionContextSecond: hide
executionSecondAdd2: hide
executionSecondReturn: hide
memoAdd2: hide

executionContextThird: hide
executionThirdNum: hide
executionThirdReturn: hide
memoNum: hide

# Returning A Function

```
{{mark1}}function funcGenerator(){
{{mark2}}    function add2(num){
{{mark3}}        return num + 2;
{{mark4}}    }

{{mark5}}    return add2;
{{mark6}}}

{{mark7}}const generatedFunc = funcGenerator();

{{mark8}}// how do we call add2 ?
{{callInnerFunction}}
```
<div class="execution-context flex rows spaces-around {{executionContextShow}}">
        <div class="call-stack-wrapper flex columns context-box">
                <div>
                    <div>Call stack</div>
                    <hr/>
                </div>
                <div class="call-stack flex columns">
                    <div class="stack-item {{callStackGeneratedFunc}}">generatedFunc()</div>
                    <div class="stack-item {{callStackfuncGenerator}}">funcGenerator()</div>
                    <div class="stack-item {{callstackGlobal}}">global()</div>
                </div>
            </div>
        <div class="thread-context flex columns context-box">
            <div>
                <div>Thread</div>
                <hr/>
            </div>
            <div class="flex columns">
                <div class="{{executionFuncGenerator}}"> function funcGenerator(){...}</div>
                <div class="{{executionGeneratedFunc}}"> generatedFunc = funcGenerator()</div>
                <div class="execution-context nested-context flex rows spaces-around {{executionContextSecond}}">
                    <div class="thread-context flex columns context-box">
                        <div>
                            <div>Thread</div>
                            <hr/>
                            <div class="flex columns">
                                <div class="{{executionSecondAdd2}}">function add2(num){...}</div>
                                <div class="{{executionSecondReturn}}">return add2</div>
                            </div>
                        </div>
                    </div>
                    <div class="var-env flex columns context-box">
                        <div>
                            <div>Memory</div>
                            <hr/>
                        </div>
                        <div class="flex columns">
                            <div class="var-dclr flex rows">
                                <div class="var-title {{memoAdd2}}">add2:</div>
                                <div class="var-value function {{memoAdd2}}"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="execution-context nested-context flex rows spaces-around {{executionContextThird}}">
                        <div class="thread-context flex columns context-box">
                            <div>
                                <div>Thread</div>
                                <hr/>
                                <div class="flex columns">
                                    <div class="{{executionThirdNum}}">num = 5</div>
                                    <div class="{{executionThirdReturn}}">return 7</div>
                                </div>
                            </div>
                        </div>
                        <div class="var-env flex columns context-box">
                            <div>
                                <div>Memory</div>
                                <hr/>
                            </div>
                            <div class="flex columns">
                                <div class="var-dclr flex rows">
                                    <div class="var-title {{memoNum}}">num:</div>
                                    <div class="var-value {{memoNum}}">5</div>
                                </div>
                            </div>
                        </div>
                    </div>
            </div>
        </div>
        <div class="var-env flex columns context-box">
            <div>
                <div>Memory</div>
                <hr/>
            </div>
            <div class="flex columns">
                <div class="flex columns">
                    <div class="var-dclr flex rows">
                        <div class="var-title {{memoFuncGenerator}}">funcGenerator:</div>
                        <div class="var-value function {{memoFuncGenerator}}"></div>
                    </div>
                    <div class="var-dclr flex rows">
                        <div class="var-title {{memoGeneratedFunc}}">generatedFunc:</div>
                        <div class="var-value {{varDefenitionGeneratedFunc}} {{memoGeneratedFunc}}"></div>
                    </div>
                    <div class="var-dclr flex rows">
                        <div class="var-title {{memoResult}}">result:</div>
                        <div class="var-value {{varDefenitionResult}} {{memoResult}}">{{memoResultVal}}</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
---
template: returning a function
---
mark1:*
callstackGlobal: active-forced
executionFuncGenerator:
memoFuncGenerator:
---
mark7:*
callstackGlobal: active-forced
executionFuncGenerator:
memoFuncGenerator:
memoGeneratedFunc:
varDefenitionGeneratedFunc: undefined-var
---
mark2:*
callstackGlobal:
callStackfuncGenerator: active-forced
executionFuncGenerator:
memoFuncGenerator:
memoGeneratedFunc:
varDefenitionGeneratedFunc: undefined-var
executionContextSecond:
memoAdd2:
executionSecondAdd2:
---
mark5:*
callstackGlobal:
callStackfuncGenerator: active-forced
executionFuncGenerator:
memoFuncGenerator:
memoGeneratedFunc:
varDefenitionGeneratedFunc: undefined-var
executionContextSecond:
memoAdd2:
executionSecondAdd2:
executionSecondReturn:
---
mark6:*
callstackGlobal: active-forced
executionFuncGenerator:
memoFuncGenerator:
memoGeneratedFunc:
varDefenitionGeneratedFunc: function
executionContextSecond: garbage-context
memoAdd2:
executionSecondAdd2:
executionSecondReturn:
---
mark8:*
callstackGlobal: active-forced
executionFuncGenerator:
memoFuncGenerator:
memoGeneratedFunc:
varDefenitionGeneratedFunc: function
executionContextSecond: garbage-context
memoAdd2:
executionSecondAdd2:
executionSecondReturn:
---
callstackGlobal: active-forced
executionFuncGenerator:
memoFuncGenerator:
memoGeneratedFunc:
varDefenitionGeneratedFunc: function
executionContextSecond: garbage-context
memoAdd2:
executionSecondAdd2:
executionSecondReturn:
callInnerFunction: *const result = generatedFunc(5);
memoResult:
varDefenitionResult: undefined-var
---
mark2:*
callstackGlobal:
callStackGeneratedFunc: active-forced
executionFuncGenerator:
memoFuncGenerator:
memoGeneratedFunc:
varDefenitionGeneratedFunc: function
executionContextSecond: garbage-context
memoAdd2:
executionSecondAdd2:
executionSecondReturn:
callInnerFunction: *const result = generatedFunc(5);
memoResult:
varDefenitionResult: undefined-var
executionContextThird:
memoNum:
executionThirdNum:
callInnerFunction: const result = generatedFunc(5);
---
mark3:*
callstackGlobal:
callStackGeneratedFunc: active-forced
executionFuncGenerator:
memoFuncGenerator:
memoGeneratedFunc:
varDefenitionGeneratedFunc: function
executionContextSecond: garbage-context
memoAdd2:
executionSecondAdd2:
executionSecondReturn:
callInnerFunction: *const result = generatedFunc(5);
memoResult:
varDefenitionResult: undefined-var
executionContextThird:
memoNum:
executionThirdNum:
executionThirdReturn:
callInnerFunction: const result = generatedFunc(5);
---
mark4:*
callstackGlobal:
callStackGeneratedFunc: active-forced
executionFuncGenerator:
memoFuncGenerator:
memoGeneratedFunc:
varDefenitionGeneratedFunc: function
executionContextSecond: garbage-context
memoAdd2:
executionSecondAdd2:
executionSecondReturn:
callInnerFunction: *const result = generatedFunc(5);
memoResult:
varDefenitionResult: undefined-var
executionContextThird: garbage-context
memoNum:
executionThirdNum:
executionThirdReturn:
callInnerFunction: const result = generatedFunc(5);
---
callstackGlobal: active-forced
executionFuncGenerator:
memoFuncGenerator:
memoGeneratedFunc:
varDefenitionGeneratedFunc: function
executionContextSecond: garbage-context
memoAdd2:
executionSecondAdd2:
executionSecondReturn:
callInnerFunction: *const result = generatedFunc(5);
memoResult:
memoResultVal: 7
varDefenitionResult:
executionContextThird: garbage-context
memoNum:
executionThirdNum:
executionThirdReturn:
callInnerFunction: const result = generatedFunc(5); // 7
---

layout: true
name: lexical scope
# Lexical (static) Scope 
<div class="note"><span class="emphesize">Where</span> you define your function determains <span class="emphesize">What</span> variables the function have access to <span class="emphesize">When</span> it gets called.</div>

---
template: lexical scope
---
layout: true
name: lexical scope with code
template: lexical scope
mark1:
mark2:
mark3:
mark4:
mark5:
mark6:
mark7:
mark8:
executionContextShow:
callStackGlobal:
callStackInc: hide
callStackExternal: hide
executionGlobalExternal: hide
executionSecondCounter: hide
executionSecondinc: hide
executionSecondincInvoke: hide
executionThirdcounter: hide
executionContextSecond: hide
executionContextThird: hide
memoCounter: hide
counterResult: 0
memoExternal: hide
memoInc: hide

```
{{mark1}}function external() {
{{mark2}}   let counter = 0;

{{mark3}}   function inc() {
{{mark4}}       counter++;
{{mark5}}   }

{{mark6}}   inc();
{{mark7}}}

{{mark8}}external();
```

<div class="execution-context flex rows spaces-around huge-font {{executionContextShow}}">
    <div class="call-stack-wrapper flex columns context-box">
            <div>
                <div>Call stack</div>
                <hr/>
            </div>
            <div class="call-stack flex columns">
                <div class="stack-item {{callStackInc}}">inc()</div>
                <div class="stack-item {{callStackExternal}}">external()</div>
                <div class="stack-item {{callStackGlobal}}">global()</div>
            </div>
        </div>
    <div class="thread-context flex columns context-box">
        <div>
            <div>Thread</div>
            <hr/>
        </div>
        <div class="flex columns">
            <div class="{{executionGlobalExternal}}">external()</div>
            <div class="execution-context bg-red nested-context flex rows spaces-around {{executionContextSecond}}">
                <div class="thread-context flex columns context-box">
                    <div>
                        <div>Thread</div>
                        <hr/>
                        <div class="flex columns">
                            <div class="{{executionSecondCounter}}">counter = 0</div>
                            <div class="{{executionSecondinc}}">function inc(){...</div>
                            <div class="{{executionSecondincInvoke}}">inc()</div>
                            <div class="execution-context bg-green nested-context flex rows spaces-around {{executionContextThird}}">
                                <div class="thread-context flex columns context-box">
                                    <div>
                                        <div>Thread</div>
                                        <hr/>
                                        <div class="flex columns">
                                            <div class="{{executionThirdcounter}}">counter++</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="var-env flex columns context-box">
                                    <div>
                                        <div>Memory</div>
                                        <hr/>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="var-env flex columns context-box">
                    <div>
                        <div>Memory</div>
                        <hr/>
                    </div>
                    <div class="flex columns">
                        <div class="var-dclr flex rows">
                            <div class="var-title {{memoCounter}}">counter:</div>
                            <div class="var-value {{memoCounter}}">{{counterResult}}</div>
                        </div>
                        <div class="var-dclr flex rows">
                            <div class="var-title {{memoInc}}">inc:</div>
                            <div class="var-value function {{memoInc}}"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="var-env flex columns context-box">
        <div>
            <div>Memory</div>
            <hr/>
        </div>
        <div class="flex columns">
            <div class="flex columns">
                <div class="var-dclr flex rows">
                    <div class="var-title {{memoExternal}}">external:</div>
                    <div class="var-value function {{memoExternal}}"></div>
                </div>
            </div>
        </div>
    </div>
</div>

---

template: lexical scope with code
executionContextShow: hide
---
mark1:*
callStackGlobal: active-forced
memoExternal:
---
mark8:*
memoExternal:
executionGlobalExternal:
callStackExternal: active-forced
executionContextSecond:
---
mark2:*
memoExternal:
executionGlobalExternal:
callStackExternal: active-forced
executionContextSecond:
executionSecondCounter:
memoCounter:
---
mark3:*
memoExternal:
executionGlobalExternal:
callStackExternal: active-forced
executionContextSecond:
executionSecondCounter:
memoCounter:
executionSecondinc: hide
memoInc:
---
mark6:*
memoExternal:
executionGlobalExternal:
callStackExternal: active-forced
executionContextSecond:
executionSecondCounter:
memoCounter:
executionSecondinc: hide
memoInc:
executionSecondincInvoke:
---
mark3:*
memoExternal:
executionGlobalExternal:
callStackExternal:
executionContextSecond:
executionSecondCounter:
memoCounter:
executionSecondinc: hide
memoInc:
executionSecondincInvoke:
executionContextThird:
callStackInc: active-forced
---
mark4:*
memoExternal:
executionGlobalExternal:
callStackExternal:
executionContextSecond:
executionSecondCounter:
memoCounter:
executionSecondinc: hide
memoInc:
counterResult: 1
executionSecondincInvoke:
executionContextThird:
executionThirdcounter:
callStackInc: active-forced
---
mark5:*
memoExternal:
executionGlobalExternal:
callStackExternal: active-forced
executionContextSecond:
executionSecondCounter:
memoCounter:
executionSecondinc: hide
memoInc:
counterResult: 1
executionSecondincInvoke:
executionContextThird: garbage-context
executionThirdcounter: 
---
mark7:*
memoExternal:
callStackGlobal: active-forced
executionGlobalExternal:
executionContextSecond: garbage-context
executionSecondCounter:
memoCounter:
executionSecondinc: hide
memoInc:
counterResult: 1
executionSecondincInvoke:
---
memoExternal:
callStackGlobal: active-forced
---
layout: false

# What if we want to call it externally?
```
function external() {
    let counter = 0;
    
    function inc() {
        counter++;
    }
}

// How can we do that without an error?
inc();  // counter = 1
inc();  // counter = 2
inc();  // counter = 3
```

### If we could do that, we had:
1. Persistent memory in between calls (data store)
2. Data Encapsulation

---
layout: true
name: closure

# The Magic Of Closure

---
layout: true
name: closure code
template: closure
mark1:
mark2:
mark3:
mark4:
mark5:
mark6:
mark7:
mark8:
mark9:
mark10:
callStackExternalInc: hide
callStackCounterGenerator: hide
executionGlobalCounterGenerator:
executionGlobalExternalIncExpression: hide
executionGlobalExternalIncFirst: hide
executionGlobalExternalIncSecond: hide
executionContextSecond: hide
executionSecondCounter: hide
executionSecondinc: hide
executionSecondincReturn: hide
memoCounter: hide
counterResult: 0
memoInc: hide
executionContextThird: hide
executionThirdCounter: hide
executionContextFourth: hide
executionFourthCounter: hide
memoExternalInc: hide
memoExternalIncVar: hide
closureBlock: hide
scope: hide
closure: hide
closureWrapper: //closure-wrapper
executionThirdlMissingVar: hide
executionFourthlMissingVar: hide
globalMissingVar: hide
```
{{mark1}}function counterGenerator() {
{{mark2}}   let counter = 0;
    
{{mark3}}   function inc() {
{{mark4}}       counter++;
{{mark5}}   }
{{mark6}}   return inc;
{{mark7}}}
{{mark8}}const externalInc = counterGenerator(); // externalInc = inc
{{mark9}}externalInc();
{{mark10}}externalInc();
```
<div class="execution-context flex rows spaces-around {{executionContextShow}}">
        <div class="call-stack-wrapper flex columns context-box">
                <div>
                    <div>Call stack</div>
                    <hr/>
                </div>
                <div class="call-stack flex columns">
                    <div class="stack-item {{callStackExternalInc}}">externalInc()</div>
                    <div class="stack-item {{callStackCounterGenerator}}">counterGenerator()</div>
                    <div class="stack-item {{callStackGlobal}}">global()</div>
                </div>
            </div>
        <div class="thread-context flex columns context-box">
            <div>
                <div>Thread</div>
                <hr/>
            </div>
            <div class="flex columns">
                <div class="{{executionGlobalCounterGenerator}}">counterGenerator(){...}</div>
                <div class="{{executionGlobalExternalIncExpression}}">externalInc = counterGenerator()</div>
                <div class="{{executionGlobalExternalIncFirst}}">externalInc()</div>
                <div class="{{executionGlobalExternalIncSecond}}">externalInc()</div>
                <div class="execution-context nested-context flex rows spaces-around {{executionContextSecond}}">
                    <div class="thread-context flex columns context-box">
                        <div>
                            <div>Thread</div>
                            <hr/>
                            <div class="flex columns">
                                <div class="{{executionSecondCounter}}">counter = 0</div>
                                <div class="{{executionSecondinc}}">function inc(){...</div>
                                <div class="{{executionSecondincReturn}}">return inc</div>
                            </div>
                        </div>
                    </div>
                    <div class="var-env flex columns context-box">
                        <div>
                            <div>Memory</div>
                            <hr/>
                        </div>
                        <div class="flex columns">
                            <div class="var-dclr flex rows">
                                <div class="var-title {{memoCounter}}">counter:</div>
                                <div class="var-value {{memoCounter}}">{{counterResult}}</div>
                            </div>
                            <div class="var-dclr flex rows">
                                <div class="var-title {{memoInc}}">inc:</div>
                                <div class="var-value function {{memoInc}}"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="execution-context nested-context flex rows spaces-around {{executionContextThird}}">
                    <div class="thread-context flex columns context-box">
                        <div>
                            <div>Thread</div>
                            <hr/>
                            <div class="flex columns">
                                <div class="{{executionThirdCounter}}">counter++</div>
                            </div>
                        </div>
                    </div>
                    <div class="var-env flex columns context-box">
                        <div>
                            <div>Memory</div>
                            <hr/>
                        </div>
                        <div class="flex columns">
                            <div class="missing-var {{executionThirdlMissingVar}}">âš </div>
                        </div>
                    </div>
                </div>
                <div class="execution-context nested-context flex rows spaces-around {{executionContextFourth}}">
                        <div class="thread-context flex columns context-box">
                            <div>
                                <div>Thread</div>
                                <hr/>
                                <div class="flex columns">
                                    <div class="{{executionFourthCounter}}">counter++</div>
                                </div>
                            </div>
                        </div>
                        <div class="var-env flex columns context-box">
                            <div>
                                <div>Memory</div>
                                <hr/>
                            </div>
                            <div class="flex columns">
                                <div class="missing-var {{executionFourthlMissingVar}}">âš </div>
                            </div>
                        </div>
                    </div>
            </div>
        </div>
        <div class="var-env flex columns context-box">
            <div>
                <div>Memory</div>
                <hr/>
            </div>
            <div class="flex columns">
                <div class="flex columns">
                    <div class="var-dclr flex rows">
                        <div class="var-title {{memoCounterGenerator}}">counterGenerator:</div>
                        <div class="var-value function {{memoCounterGenerator}}"></div>
                    </div>
                    <div class="{{closureWrapper}} flex columns">
                        <div class="var-dclr flex rows">
                            <div class="var-title {{memoExternalInc}}">externalInc:</div>
                            <div class="var-value {{memoExternalIncVar}}"></div>
                        </div>
                        <div class="flex columns {{closureBlock}}">
                            <div class="{{scope}}">[[scope]]</div>
                            <div class="flex rows {{closure}}">
                                <div class="closure-arrow">â†³</div>
                                <div class="var-value closure">
                                    {
                                        counter: {{counterResult}}
                                    }
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="missing-var {{globalMissingVar}}">âš </div>
                </div>
            </div>
        </div>
    </div>

---
template: closure code
executionGlobalCounterGenerator: hide
memoCounterGenerator: hide
---
mark1:*
callStackGlobal: active-forced
---
mark8:*
callStackGlobal: active-forced
executionGlobalExternalIncExpression:
memoExternalInc:
memoExternalIncVar: undefined-var
---
mark2:*
callStackCounterGenerator: active-forced
executionGlobalExternalIncExpression:
memoExternalInc:
memoExternalIncVar: undefined-var
executionContextSecond:
executionSecondCounter:
memoCounter:
---
mark3:*
callStackCounterGenerator: active-forced
executionGlobalExternalIncExpression:
memoExternalInc:
memoExternalIncVar: undefined-var
executionContextSecond:
executionSecondCounter:
memoCounter:
executionSecondinc:
memoInc:
---
mark6:*
callStackCounterGenerator: active-forced
executionGlobalExternalIncExpression:
memoExternalInc:
memoExternalIncVar: undefined-var
executionContextSecond:
executionSecondCounter:
memoCounter:
memoInc:
executionSecondinc:
executionSecondincReturn:
---
mark7:*
callStackGlobal: active-forced
executionGlobalExternalIncExpression:
memoExternalInc:
memoExternalIncVar: function
executionContextSecond:
executionSecondCounter:
memoCounter:
memoInc:
executionSecondinc:
executionSecondincReturn:
executionContextSecond: garbage-context
---
mark9:*
callStackGlobal: active-forced
executionGlobalExternalIncExpression:
memoExternalInc:
memoExternalIncVar: function
executionContextSecond:
executionSecondCounter:
memoCounter:
memoInc:
executionSecondinc:
executionSecondincReturn:
executionContextSecond: garbage-context
---
mark3:*
callStackExternalInc: active-forced
executionGlobalExternalIncExpression:
memoExternalInc:
memoExternalIncVar: function
executionContextSecond:
executionSecondCounter:
memoCounter:
memoInc:
executionSecondinc:
executionSecondincReturn:
executionContextSecond: garbage-context
executionContextThird:
---
mark4:*
callStackExternalInc: active-forced
executionGlobalExternalIncExpression:
memoExternalInc:
memoExternalIncVar: function
executionContextSecond:
executionSecondCounter:
memoCounter:
memoInc:
executionSecondinc:
executionSecondincReturn:
executionContextSecond: garbage-context
executionContextThird:
executionThirdCounter:
---
mark4:*
callStackExternalInc: active-forced
executionGlobalExternalIncExpression:
memoExternalInc:
memoExternalIncVar: function
executionContextSecond:
executionSecondCounter:
memoCounter:
memoInc:
executionSecondinc:
executionSecondincReturn:
executionContextSecond: garbage-context
executionContextThird:
executionThirdCounter:
executionThirdlMissingVar:
---
mark4:*
callStackExternalInc: active-forced
executionGlobalExternalIncExpression:
memoExternalInc:
memoExternalIncVar: function
executionContextSecond:
executionSecondCounter:
memoCounter:
memoInc:
executionSecondinc:
executionSecondincReturn:
executionContextSecond: garbage-context
executionContextThird:
executionThirdCounter:
executionThirdlMissingVar:
globalMissingVar:
---
template: lexical scope
--
<hr/>
### Don't forget where we defined the function
```
function counterGenerator() {
    let counter = 0;
*   function inc() {
*       counter++;
*   }
    return inc;
}
```
---
mark4:*
callStackExternalInc: active-forced
executionGlobalExternalIncExpression:
memoExternalInc:
memoExternalIncVar: function
executionContextSecond:
executionSecondCounter:
memoCounter:
memoInc:
executionSecondinc:
executionSecondincReturn:
executionContextSecond: garbage-context
executionContextThird:
executionThirdCounter:
closureBlock:
closure:
closureWrapper: closure-wrapper
---
mark4:*
callStackExternalInc: active-forced
executionGlobalExternalIncExpression:
memoExternalInc:
memoExternalIncVar: function
executionContextSecond:
executionSecondCounter:
memoCounter:
memoInc:
executionSecondinc:
executionSecondincReturn:
executionContextSecond: garbage-context
executionContextThird:
executionThirdCounter:
closureBlock:
closure:
closureWrapper: closure-wrapper
scope:
---
mark4:*
callStackExternalInc: active-forced
executionGlobalExternalIncExpression:
memoExternalInc:
memoExternalIncVar: function
executionContextSecond:
executionSecondCounter:
memoCounter:
memoInc:
executionSecondinc:
executionSecondincReturn:
executionContextSecond: garbage-context
executionContextThird:
executionThirdCounter:
closureBlock:
closure:
closureWrapper: closure-wrapper
scope:
counterResult: 1
---
mark5:*
callStackGlobal: active-forced
executionGlobalExternalIncExpression:
memoExternalInc:
memoExternalIncVar: function
executionContextSecond:
executionSecondCounter:
memoCounter:
memoInc:
executionSecondinc:
executionSecondincReturn:
executionContextSecond: garbage-context
executionContextThird: garbage-context
executionThirdCounter:
closureBlock:
closure:
closureWrapper: closure-wrapper
scope:
counterResult: 1
---
mark10:*
callStackGlobal: active-forced
executionGlobalExternalIncExpression:
memoExternalInc:
memoExternalIncVar: function
executionContextSecond:
executionSecondCounter:
memoCounter:
memoInc:
executionSecondinc:
executionSecondincReturn:
executionContextSecond: garbage-context
executionContextThird: garbage-context
executionThirdCounter:
closureBlock:
closure:
closureWrapper: closure-wrapper
scope:
counterResult: 1
---
mark3:*
callStackExternalInc: active-forced
executionGlobalExternalIncExpression:
memoExternalInc:
memoExternalIncVar: function
executionContextSecond:
executionSecondCounter:
memoCounter:
memoInc:
executionSecondinc:
executionSecondincReturn:
executionContextSecond: garbage-context
executionContextThird: garbage-context
executionThirdCounter:
closureBlock:
closure:
closureWrapper: closure-wrapper
scope:
counterResult: 1
executionContextFourth:
---
mark4:*
callStackExternalInc: active-forced
executionGlobalExternalIncExpression:
memoExternalInc:
memoExternalIncVar: function
executionContextSecond:
executionSecondCounter:
memoCounter:
memoInc:
executionSecondinc:
executionSecondincReturn:
executionContextSecond: garbage-context
executionContextThird: garbage-context
executionThirdCounter:
closureBlock:
closure:
closureWrapper: closure-wrapper
scope:
counterResult: 1
executionContextFourth:
executionFourthCounter:
executionFourthlMissingVar:
--
counterResult: 2
--
mark4:
mark5:*
executionContextFourth: garbage-context
--
mark4:
mark5:
callStackGlobal: active-forced
callStackExternalInc: hide

---
layout: false
# What can we do with persistent data?
For example we can memoize our functions:

Turn this
```
function square(num){
    return num * num;
}

const result = square(5);

const result2 = square(5); // a second calculation
```
Into this
```
function memoSquareGenerator(){
    let cache = {};
    
    function square(num){
        if(cache[num]){
            return cache[num];
        } else {
            cache[num] = num * num;
            return cache[num];
        }
    }

    return square;
}

const memoSquare = memoSquareGenerator();

const result = memoSquare(5);

const result2 = memoSquare(5); // no extra calculations
```

---
Or even better, we can generalize it:

```
function memoize(fn) {
    var cache = {};

    return function(...args) {
        const key = JSON.stringify(args);
        const result = cache[key] = cache[key] || fn(...args);
        return result
    }
}

const double = memoize(n => n * 2);
const square = memoize(n => n * n);

const result = double(5); // 10

const result2 = square(5); // 25

```
--
**Note - ** This pattern is called currying (after Haskell Brooks Curry)
 <blockquote>Currying is the process of breaking down a function into a series of functions that each take a single argument. </blockquote>

---
template: questions
---
template: chapter
number: 5
title: Event loop, again?!
subtitle: What about rendering???

---
class: center, middle, fade
layout: true
name: raf
blockingWhile: hide
noneBlockingWhile: hide
# {{title}} 
<div class="big-image-wrapper"><img class="big-image" src="Event_Loop/{{imageName}}" /></div>
<div class="overlay {{blockingWhile}}">
<pre style="text-align: left; display: flex; font-size: 1.8em">
<code style="background-color: transparent">btn.addEventListener('click', evt => {
    while(true);
});
</code>
</pre>
</div>

<div class="overlay {{noneBlockingWhile}}">
<pre style="text-align: left; display: flex; font-size: 1.8em">
<code style="background-color: transparent">function loop() {
    setTimeout(loop, 0);
}

loop();
</code> 
</pre>
</div>
---

template: raf
title: This is the event loop
imageName: simple_task.gif
<a target="_blank" class="external-link" href="https://www.youtube.com/watch?v=cCOL7MC4Pl0&vl=iw">Jake Archibald - The Secret of the Loop</a>
---
title: These are the render steps
imageName: render steps.gif
--
title: Blocking Tasks
blockingWhile:
---
title: Blocking Tasks
imageName: while loop normal task.gif
--
title: None Blocking Tasks
noneBlockingWhile:
---
title: None Blocking Tasks
imageName: while loop setTimeout.gif
---
title: Request Animation Frame (rAF)
imageName: with_rAF.gif

---
layout: true
template: false
name: move a box
title:
demoParams:
class: huge-font
### {{title}}

<div>
    <a style="position: absolute; bottom: 20px" class="external-link {{demoClass}}" href="move-box.html?{{demoParams}}" target="_blank">Demo</a>
</div>

---
template: move a box
title: Move a box
demoClass: transparent

```
// The move function
function move1px(el) {
    let left = 0;
    return function () {
        // infinite looping logic - if off screen start over
        if (document.documentElement.clientWidth < left) {
            left = 0;
        } else {
            left++;
        }
        // move left by 1 px
        el.style.left = left + 'px';
    }
}
```
--
template: move a box
title: raF Solution
demoClass:
```
// using rAF
const moveBox1 = move1px(box1);
function callback() {
    moveBox1();
    requestAnimationFrame(callback);
}
callback();
```
--
template: move a box
title: setInterval Solution
demoClass:
demoParams: box2
```
// using a task (setInterval)
const moveBox2 = move1px(box2);
setInterval(moveBox2, 0);
```
--
template: move a box
title: setInterval hack Solution
demoParams: box2&box3
```
// using a task with a hack
const moveBox3 = move1px(box3);
setInterval(moveBox2, 1000 / 60);
```

---
template: raf
title: rAF callback is invoked on each frame
imageName: with_rAF.gif

---
layout: true
name: que process
title:
imageName:
imageClass:
class: center, middle, fade

# 3 Different Que types

#### {{title}}
<img class="{{imageClass}}" src="Event_Loop/{{imageName}}" />
---

template: que process
imageClass: transparent
title: Not all ques are processed the same way
imageName: loop priority tasks.gif
---

template: que process
title: Task Que - Run 1 item at a time
imageName: loop priority tasks.gif
---
template: que process
title: rAF callbacks - run to completion (except new items)
imageName: loop priority rAF.gif
---
template: que process
title: Micro Tasks - run to completion (with new items)
imageName: loop priority micro tasks _promises.gif

---
template: questions
---
layout: false
class: fade

# Useful Links 
<a class="external-link" href="https://developer.mozilla.org/en-US/docs/Web/API" target="_blank">developer.mozilla.org/en-US/docs/Web/API</a>

<a target="_blank" class="external-link" href="https://www.youtube.com/watch?v=cCOL7MC4Pl0&vl=iw">Jake Archibald - The Secret of the Loop</a>

<a target="_blank" class="external-link" href="https://www.youtube.com/watch?v=8aGhZQkoFbQ">Philip Roberts: What the heck is the event loop anyway?</a>

<a target="_blank" class="external-link" href="https://frontendmasters.com/courses/javascript-hard-parts/">Will Sentance - JavaScript: The Hard Parts</a>

---

class: middle, home, fade

# Async JavaScript
## FROM SCRATCH
#### Part #2
<div style="font-family: 'Yanone Kaffeesatz'; font-size: 1.2em ">To be continued...</div>
</textarea>

    <script src="https://remarkjs.com/downloads/remark-latest.min.js">
    </script>
    <script>
        var slideshow = remark.create({
            ratio: '16:9', // default 4:3
            highlightLanguage: "javascript",
            highlightStyle: "dracula",
            highlightLines: true,
            navigation: {
                scroll: false,
            }
        });
    </script>
</body>

</html>



<script>
/* memoize
function memoize(fn) {
    var cache = {};
    return function(...args) {
        const key = JSON.stringify(args);
        const result = cache[key] = cache[key] || fn(...args);
        return result
    }
}

const double = memoize(n => n * 2);
const square = memoize(n => n * n);

const result = double(5);
console.log('result', result);
const result2 = double(5);
console.log('result2', result2);
*/
</script>